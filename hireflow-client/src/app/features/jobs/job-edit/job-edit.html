<p-toast position="top-right"></p-toast>
<p-confirm-dialog></p-confirm-dialog>


<div class="min-h-screen bg-surface-50 p-4 md:p-8 flex justify-center">
    <div class="w-full max-w-5xl" *ngIf="job || store.isLoading()">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div class="flex items-start gap-4">
                <p-button 
                    icon="pi pi-arrow-left" 
                    [rounded]="true" 
                    [text]="true" 
                    severity="secondary" 
                    (onClick)="goBack()">
                </p-button>
                <div>
                    <h1 class="text-2xl font-bold text-surface-900 m-0">Edit Job Posting</h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-surface-500 text-sm font-mono">ID: {{ jobId }}</span>
                        <p-tag [value]="job?.status" [severity]="getSeverity(job?.status!)"></p-tag>
                    </div>
                </div>
            </div>

            <div class="flex gap-2" *ngIf="job">
                <p-button 
                    *ngIf="job.status === 'Draft'"
                    label="Publish Job" 
                    icon="pi pi-send" 
                    severity="success" 
                    [loading]="store.isLoading()"
                    (onClick)="onPublish()">
                </p-button>

                <p-button 
                    *ngIf="job.status === 'Published'"
                    label="Close Job" 
                    icon="pi pi-ban" 
                    severity="danger" 
                    [outlined]="true"
                    [loading]="store.isLoading()"
                    (onClick)="onClose()">
                </p-button>
            </div>
        </div>

        <div class="card bg-surface-0 border border-surface-200 rounded-xl shadow-sm p-6 md:p-8">
            <form [formGroup]="form" (ngSubmit)="onSave()">
                
                <p-fluid class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    
                    <div class="flex flex-col gap-2">
                        <label for="title" class="font-medium text-surface-900">
                            Job Title <span class="text-red-500">*</span>
                        </label>
                        <input 
                            pInputText 
                            id="title" 
                            formControlName="title" 
                            [class.ng-invalid]="hasError('title')" 
                        />
                        <small *ngIf="form.get('title')?.hasError('required') && form.get('title')?.touched" class="text-red-500">
                            Title is required.
                        </small>
                        <small *ngIf="store.validationErrors()['title']" class="text-red-500">
                            {{ store.validationErrors()['title'][0] }}
                        </small>
                    </div>

                    <div class="flex flex-col gap-2">
                        <label for="workMode" class="font-medium text-surface-900">Work Mode</label>
                        <p-select 
                            inputId="workMode"
                            [options]="workModes" 
                            formControlName="workMode" 
                            optionLabel="label" 
                            optionValue="value" 
                            placeholder="Select a Work Mode">
                        </p-select>
                    </div>
                </p-fluid>

                <div class="flex flex-col gap-2 mb-8">
                    <div class="flex justify-between items-center">
                        <label for="description" class="font-medium text-surface-900">Description</label>
                        <span class="text-xs text-surface-500 bg-surface-100 px-2 py-1 rounded">
                            {{ form.get('description')?.value?.length || 0 }} / 4000
                        </span>
                    </div>
                    
                    <textarea 
                        pTextarea 
                        id="description" 
                        formControlName="description" 
                        rows="15" 
                        class="w-full !resize-none leading-relaxed font-normal text-surface-700" 
                        placeholder="Describe the role, responsibilities, and requirements..."
                        [autoResize]="false">
                    </textarea>
                    
                    <small *ngIf="store.validationErrors()['description']" class="text-red-500">
                        {{ store.validationErrors()['description'][0] }}
                    </small>
                </div>

                <div class="flex justify-end pt-6 border-t border-surface-100">
                    <p-button 
                        label="Discard Changes" 
                        severity="secondary" 
                        [text]="true" 
                        class="mr-2"
                        (onClick)="goBack()">
                    </p-button>
                    
                    <p-button 
                        label="Save Changes" 
                        icon="pi pi-save" 
                        type="submit" 
                        [loading]="store.isLoading()"
                        [disabled]="form.invalid">
                    </p-button>
                </div>
            </form>
        </div>
    </div>
</div>